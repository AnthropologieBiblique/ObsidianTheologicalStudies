/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var N=Object.create;var v=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var H=l=>v(l,"__esModule",{value:!0});var F=(l,e)=>{H(l);for(var t in e)v(l,t,{get:e[t],enumerable:!0})},Q=(l,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of L(e))!I.call(l,s)&&s!=="default"&&v(l,s,{get:()=>e[s],enumerable:!(t=_(e,s))||t.enumerable});return l},x=l=>Q(H(v(l!=null?N(V(l)):{},"default",l&&l.__esModule&&"default"in l?{get:()=>l.default,enumerable:!0}:{value:l,enumerable:!0})),l);var S=(l,e,t)=>new Promise((s,a)=>{var r=o=>{try{i(t.next(o))}catch(d){a(d)}},n=o=>{try{i(t.throw(o))}catch(d){a(d)}},i=o=>o.done?s(o.value):Promise.resolve(o.value).then(r,n);i((t=t.apply(l,e)).next())});F(exports,{default:()=>D});function g(l,e){let t=Object.keys(e).map(s=>z(l,s,e[s]));return t.length===1?t[0]:function(){t.forEach(s=>s())}}function z(l,e,t){let s=l[e],a=l.hasOwnProperty(e),r=t(s);return s&&Object.setPrototypeOf(r,s),Object.setPrototypeOf(n,r),l[e]=n,i;function n(...o){return r===s&&l[e]===n&&i(),r.apply(this,o)}function i(){l[e]===n&&(a?l[e]=s:delete l[e]),r!==s&&(r=s,Object.setPrototypeOf(n,s||Function))}}var u=x(require("obsidian"));var R=x(require("obsidian")),B=R.requireApiVersion&&(0,R.requireApiVersion)("0.15.0"),O=class extends R.MarkdownRenderer{constructor(e,t,s){super(e,t);this.app=e,this.match=s,this.subpath="",this.indent="",this.filePath=B?this.match.parentDom.path:this.match.parent.path,this.file=B?this.match.parentDom.file:this.match.parent.file,this.renderer.previewEl.onNodeInserted(()=>(this.updateOptions(),this.renderer.onResize()))}updateOptions(){let e=this.app.vault.getConfig("readableLineLength");this.renderer.previewEl.toggleClass("is-readable-line-width",e);let t=this.app.vault.getConfig("foldHeading");this.renderer.previewEl.toggleClass("allow-fold-headings",t);let s=this.app.vault.getConfig("foldIndent");this.renderer.previewEl.toggleClass("allow-fold-lists",s),this.renderer.previewEl.toggleClass("rtl",this.app.vault.getConfig("rightToLeft")),t||this.renderer.unfoldAllHeadings(),s||this.renderer.unfoldAllLists(),this.renderer.previewEl.toggleClass("show-frontmatter",this.app.vault.getConfig("showFrontmatter"));let a=this.app.vault.getConfig("tabSize");this.renderer.previewEl.style.tabSize=String(a),this.renderer.rerender()}onRenderComplete(){}getFile(){return this.match.parent.file}edit(e){return S(this,null,function*(){var o;this.renderer.set(e);let t=yield this.app.vault.cachedRead(this.file),a=(o=t.slice(this.match.start,this.match.end).match(/^\s+/g))==null?void 0:o.first();a&&(e=e.replace(/^/gm,a));let r=t.slice(0,this.match.start),n=t.slice(this.match.end,this.match.parent.content.length);var i=r+e+n;this.app.vault.modify(this.file,i)})}};var m=x(require("obsidian"));var f=i18next.t.bind(i18next);var P={defaultCollapse:!1,defaultShowContext:!1,defaultHideTitle:!1,defaultHideResults:!1,defaultRenderMarkdown:!1,defaultSortOrder:"alphabetical"},b={alphabetical:f("plugins.file-explorer.label-sort-a-to-z"),alphabeticalReverse:f("plugins.file-explorer.label-sort-z-to-a"),byModifiedTime:f("plugins.file-explorer.label-sort-new-to-old"),byModifiedTimeReverse:f("plugins.file-explorer.label-sort-old-to-new"),byCreatedTime:f("plugins.file-explorer.label-sort-created-new-to-old"),byCreatedTimeReverse:f("plugins.file-explorer.label-sort-created-old-to-new")},T=class extends m.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}hide(){}display(){let{containerEl:e}=this;e.empty(),new m.Setting(e).setName("Collapse query results by default").addToggle(t=>t.setValue(this.plugin.settings.defaultCollapse).onChange(s=>{this.plugin.settings.defaultCollapse=s,this.plugin.saveSettings()})),new m.Setting(e).setName("Show additional query result context by default").addToggle(t=>t.setValue(this.plugin.settings.defaultShowContext).onChange(s=>{this.plugin.settings.defaultShowContext=s,this.plugin.saveSettings()})),new m.Setting(e).setName("Hide query title by default").addToggle(t=>t.setValue(this.plugin.settings.defaultHideTitle).onChange(s=>{this.plugin.settings.defaultHideTitle=s,this.plugin.saveSettings()})),new m.Setting(e).setName("Hide query results by default").addToggle(t=>t.setValue(this.plugin.settings.defaultHideResults).onChange(s=>{this.plugin.settings.defaultHideResults=s,this.plugin.saveSettings()})),new m.Setting(e).setName("Render results as Markdown by default").addToggle(t=>t.setValue(this.plugin.settings.defaultRenderMarkdown).onChange(s=>{this.plugin.settings.defaultRenderMarkdown=s,this.plugin.saveSettings()})),new m.Setting(e).setName("Default query result sort order").addDropdown(t=>{t.addOptions(b),t.setValue(this.plugin.settings.defaultSortOrder),t.onChange(s=>S(this,null,function*(){this.plugin.settings.defaultSortOrder=s,yield this.plugin.saveSettings()}))})}};var k=u.requireApiVersion&&(0,u.requireApiVersion)("0.15.0"),pe=new WeakMap,A=new WeakMap,D=class extends u.Plugin{onload(){return S(this,null,function*(){yield this.loadSettings();let e=this;this.registerSettingsTab(),this.register(g(this.app.viewRegistry.constructor.prototype,{registerView(s){return function(a,r,...n){return e.app.workspace.trigger("view-registered",a,r),s.call(this,a,r,...n)}}}));let t;if(this.app.workspace.layoutReady)this.getSearchExport();else{let s=this.app.workspace.on("view-registered",(a,r)=>{if(a!=="search")return;this.app.workspace.offref(s);let n=new u.WorkspaceLeaf(e.app),i=r(n);e.patchNativeSearch(i);let o=g(u.Modal.prototype,{open(d){return function(...c){e.SearchResultsExport=this.constructor}}});i.onCopyResultsClick(new MouseEvent(null)),o(),e.SearchHeaderDOM=i.headerDom.constructor})}this.register(t=g(u.Component.prototype,{addChild(s){return function(a,...r){try{if(!e.isSearchPatched&&a instanceof u.Component&&a.hasOwnProperty("searchQuery")&&a.hasOwnProperty("sourcePath")&&a.hasOwnProperty("dom")){let i=a;e.patchSearchView(i),e.isSearchPatched=!0}if(a instanceof u.Component&&a.hasOwnProperty("backlinkDom")){let i=a;A.set(i.backlinkDom.el.closest(".backlink-pane"),a),e.isBacklinksPatched||(e.patchBacklinksView(i),e.isBacklinksPatched=!0)}}catch(i){console.log(i)}return s.call(this,a,...r)}}}))})}loadSettings(){return S(this,null,function*(){this.settings=Object.assign({},P,yield this.loadData())})}saveSettings(){return S(this,null,function*(){yield this.saveData(this.settings)})}registerSettingsTab(){this.settingsTab=new T(this.app,this),this.addSettingTab(this.settingsTab)}getSearchHeader(){var t,s,a;let e=(a=(s=(t=this.app.workspace.getLeavesOfType("search"))==null?void 0:t.first())==null?void 0:s.view)==null?void 0:a.headerDom;return e==null?void 0:e.constructor}getSearchExport(){var a,r;let e=this,t=(r=(a=this.app.workspace.getLeavesOfType("search"))==null?void 0:a.first())==null?void 0:r.view,s=g(u.Modal.prototype,{open(n){return function(...i){e.SearchResultsExport=this.constructor}}});t==null||t.onCopyResultsClick(new MouseEvent(null)),s()}onunload(){}patchNativeSearch(e){let t=this;this.register(g(e.constructor.prototype,{onResize(s){return function(...a){var n;let r=k?(n=this.dom.vChildren)==null?void 0:n._children:this.dom.children;return this.dom.el.clientWidth===0?(r.forEach(i=>{i.setCollapse(!0,!1)}),this.dom.hidden=!0):this.dom.hidden&&(this.dom.hidden=!1,setTimeout(()=>{r.forEach(i=>{i.setCollapse(this.dom.collapseAll,!1)})},100)),s.call(this,...a)}},stopSearch(s){return function(...a){let r=s.call(this,...a);return this.renderComponent&&(this.renderComponent.unload(),this.renderComponent=new u.Component),r}},addChild(s){return function(...a){try{if(!this.patched){this.renderComponent||(this.renderComponent=new u.Component,this.renderComponent.load()),this.patched=!0,this.dom.parent=this,t.patchSearchResultDOM(this.dom.constructor),this.setRenderMarkdown=function(i){var d;let o=k?(d=this.dom.vChildren)==null?void 0:d._children:this.dom.children;this.dom.renderMarkdown=i,o.forEach(c=>{c.renderContentMatches()}),this.dom.infinityScroll.invalidateAll(),this.dom.childrenEl.toggleClass("cm-preview-code-block",i),this.dom.childrenEl.toggleClass("is-rendered",i),this.renderMarkdownButtonEl.toggleClass("is-active",i)},this.renderMarkdownButtonEl=this.headerDom.addNavButton("reading-glasses","Render Markdown",()=>this.setRenderMarkdown(!this.dom.renderMarkdown));let n={renderMarkdown:t.settings.defaultRenderMarkdown};this.settings||(this.settings={}),Object.entries(n).forEach(([i,o])=>{this.settings.hasOwnProperty(i)?i==="sort"&&!b.hasOwnProperty(this.settings.sort)&&(this.settings[i]=o):this.settings[i]=o}),this.setRenderMarkdown(this.settings.renderMarkdown)}}catch(n){console.log(n)}return s.call(this,...a)}}}))}patchSearchResultDOM(e){let t=this,s=g(e.prototype,{addResult(a){return function(...r){s();let n=a.call(this,...r),i=n.constructor;return t.isSearchResultItemPatched||t.patchSearchResultItem(i),n}}});this.register(s),this.register(g(e.prototype,{startLoader(a){return function(...r){var i,o;try{let d=this.el.closest(".backlink-pane"),c=A.get(d);if(d&&c){if(c.patched)return;j(this,t,d,c);return}if(!this.patched&&((i=this.el.parentElement)==null?void 0:i.hasClass("internal-query"))&&((o=this.el)==null?void 0:o.closest(".internal-query"))){this.patched=!0;let p=this.el.parentElement.querySelector(".internal-query-header");this.setExtraContext=function(h){var C;let E=k?(C=this.vChildren)==null?void 0:C._children:this.children;this.extraContext=h,this.extraContextButtonEl.toggleClass("is-active",h),E.forEach(M=>{M.setExtraContext(h)}),this.infinityScroll.invalidateAll()},this.setTitleDisplay=function(h){this.showTitle=h,this.showTitleButtonEl.toggleClass("is-active",h),p.toggleClass("is-hidden",h)},this.setResultsDisplay=function(h){this.showResults=h,this.showResultsButtonEl.toggleClass("is-active",h),this.el.toggleClass("is-hidden",h)},this.setRenderMarkdown=function(h){var C;this.renderMarkdown=h,(k?(C=this.vChildren)==null?void 0:C._children:this.children).forEach(M=>{M.renderContentMatches()}),this.infinityScroll.invalidateAll(),this.childrenEl.toggleClass("cm-preview-code-block",h),this.childrenEl.toggleClass("is-rendered",h),this.renderMarkdownButtonEl.toggleClass("is-active",h)},this.setCollapseAll=function(h){var C;let E=k?(C=this.vChildren)==null?void 0:C._children:this.children;this.collapseAllButtonEl.toggleClass("is-active",h),this.collapseAll=h,E.forEach(M=>{M.setCollapse(h,!1)}),this.infinityScroll.invalidateAll()},this.setSortOrder=h=>{this.sortOrder=h,this.changed(),this.infinityScroll.invalidateAll()},this.onCopyResultsClick=h=>{h.preventDefault(),new t.SearchResultsExport(this.app,this).open()};let y=t.SearchHeaderDOM?t.SearchHeaderDOM:t.getSearchHeader(),w=this.headerDom=new y(this.app,this.el.parentElement);p.insertAdjacentElement("afterend",w.navHeaderEl),this.collapseAllButtonEl=w.addNavButton("bullet-list",f("plugins.search.label-collapse-results"),()=>this.setCollapseAll(!this.collapseAll)),this.extraContextButtonEl=w.addNavButton("expand-vertically",f("plugins.search.label-more-context"),()=>this.setExtraContext(!this.extraContext)),w.addSortButton(h=>this.setSortOrder(h),()=>this.sortOrder),this.showTitleButtonEl=w.addNavButton("strikethrough-glyph","Hide title",()=>this.setTitleDisplay(!this.showTitle)),this.showResultsButtonEl=w.addNavButton("minus-with-circle","Hide results",()=>this.setResultsDisplay(!this.showResults)),this.renderMarkdownButtonEl=w.addNavButton("reading-glasses","Render Markdown",()=>this.setRenderMarkdown(!this.renderMarkdown)),w.addNavButton("documents","Copy results",this.onCopyResultsClick.bind(this));let q={title:t.settings.defaultHideResults,collapsed:t.settings.defaultCollapse,context:t.settings.defaultShowContext,hideTitle:t.settings.defaultHideTitle,hideResults:t.settings.defaultHideResults,renderMarkdown:t.settings.defaultRenderMarkdown,sort:t.settings.defaultSortOrder};this.settings||(this.settings={}),Object.entries(q).forEach(([h,E])=>{this.settings.hasOwnProperty(h)?h==="sort"&&!b.hasOwnProperty(this.settings.sort)&&(this.settings[h]=E):this.settings[h]=E}),this.setExtraContext(this.settings.context),this.sortOrder=this.settings.sort,this.setCollapseAll(this.settings.collapsed),this.setTitleDisplay(this.settings.hideTitle),this.setRenderMarkdown(this.settings.renderMarkdown),this.setResultsDisplay(this.settings.hideResults)}}catch(d){console.log(d)}return a.call(this,...r)}}}))}patchSearchResultItem(e){this.isSearchResultItemPatched=!0;let t=this,s=g(e.prototype,{onResultClick(a){return function(r,n,...i){if(!(r.target instanceof HTMLElement&&(r.target.hasClass("internal-link")||r.target.hasClass("task-list-item-checkbox")||r.target.hasClass("admonition-title-content"))))return a.call(this,r,n,...i)}},renderContentMatches(a){return function(...r){var o;let n=a.call(this,...r),i=k?(o=this.vChildren)==null?void 0:o._children:this.children;if(!t.isSearchResultItemMatchPatched&&i.length){let d=i.first().constructor;t.patchSearchResultItemMatch(d)}return n}}});t.register(s)}patchSearchResultItemMatch(e){this.isSearchResultItemMatchPatched=!0;let t=this;t.register(g(e.prototype,{render(s){return function(...a){var d;let r=k?this.parentDom:this.parent,n=r.content.substring(this.start,this.end).replace("```query","\\`\\`\\`query"),i=(d=n.match(/^\s+/g))==null?void 0:d.first();i&&(n=n.replace(new RegExp(`^${i}`,"gm"),""));let o=r.parent.parent;if(o&&r.parent.renderMarkdown){let c=o==null?void 0:o.renderComponent;this.el.empty();let p=new O(t.app,this.el,this);p.onRenderComplete=()=>{var y;(y=r==null?void 0:r.parent)==null||y.infinityScroll.measure(r,this)},c.addChild(p),p.renderer.set(n)}else return s.call(this,...a)}}}))}patchSearchView(e){let t=this,s=e.constructor,a=e.dom.constructor;this.register(g(s.prototype,{onunload(r){return function(...n){return this.renderComponent&&(this.renderComponent.unload(),this.dom=null,this.queue=null,this.renderComponent=null,this._children=null,this.containerEl=null),r.call(this,...n)}},onload(r){return function(...n){try{this.renderComponent||(this.renderComponent=new u.Component,this.renderComponent.load()),this.dom.parent=this;let o=this.containerEl.parentElement.querySelector(".internal-query-header"),d=this.query.matchAll(/^(?<key>collapsed|context|hideTitle|renderMarkdown|hideResults|sort|title):\s*(?<value>.+?)$/gm),c={};for(let p of d){let y=p.groups.value.toLowerCase();(y==="true"||y==="false")&&(p.groups.value=y==="true"),c[p.groups.key]=p.groups.value}this.query=this.query.replace(/^((collapsed|context|hideTitle|renderMarkdown|hideResults|sort|title):.+?)$/gm,"").trim(),o.setText(c.title||this.query),this.dom.settings=c}catch(o){}return r.call(this,...n)}}})),this.patchSearchResultDOM(a)}patchBacklinksView(e){let t=this,s=e.constructor,a=e.backlinkDom.constructor;this.register(g(s.prototype,{onunload(r){return function(...n){return this.renderComponent&&(this.renderComponent.unload(),this.dom=null,this.queue=null,this.renderComponent=null,this._children=null,this.containerEl=null),r.call(this,...n)}},onload(r){return function(...n){try{this.renderComponent||(this.renderComponent=new u.Component,this.renderComponent.load()),this.backlinkDom.parent=this,this.unlinkedDom.parent=this;let o={};this.dom.settings=o}catch(o){}return r.call(this,...n)}}})),this.patchSearchResultDOM(a)}};function j(l,e,t,s){if(s){s.patched=!0;let a=t.querySelector(".internal-query-header")||t.querySelector(".nav-header");l.setRenderMarkdown=function(n){[s.backlinkDom,s.unlinkedDom].forEach(o=>{var c;o.renderMarkdown=n,(k?(c=o.vChildren)==null?void 0:c._children:o.children).forEach(p=>{p.renderContentMatches()}),o.infinityScroll.invalidateAll(),o.childrenEl.toggleClass("cm-preview-code-block",n),o.childrenEl.toggleClass("is-rendered",n)}),this.renderMarkdownButtonEl.toggleClass("is-active",n)},l.onCopyResultsClick=n=>{n.preventDefault(),new e.SearchResultsExport(l.app,l).open()},l.renderMarkdownButtonEl=s.headerDom.addNavButton("reading-glasses","Render Markdown",()=>l.setRenderMarkdown(!l.renderMarkdown)),s.headerDom.addNavButton("documents","Copy results",l.onCopyResultsClick.bind(l));let r={title:e.settings.defaultHideResults,collapsed:e.settings.defaultCollapse,context:e.settings.defaultShowContext,hideTitle:e.settings.defaultHideTitle,hideResults:e.settings.defaultHideResults,renderMarkdown:e.settings.defaultRenderMarkdown,sort:e.settings.defaultSortOrder};l.settings||(l.settings={}),Object.entries(r).forEach(([n,i])=>{l.settings.hasOwnProperty(n)?n==="sort"&&!b.hasOwnProperty(l.settings.sort)&&(l.settings[n]=i):l.settings[n]=i}),s.setExtraContext(l.settings.context),s.sortOrder=l.settings.sort,s.setCollapseAll(l.settings.collapsed),l.setRenderMarkdown(l.settings.renderMarkdown)}}
